## End to end IoT System

This project is an end-to-end IoT application for collecting and aggregating data from virtual IoT devices placed around the world.

**Our IoT system is a distributed application that leverages:**

-   TCP client-server communication

    -   TCP Client: Handles user query input and communication with the server
    -   TCP Server: Processes IoT device queries, retrieves data from MongoDB

-   MongoDB database for data storage
    -   Stores IoT sensor data and device metadata
-   IoT devices from dataniz
    -   Once all devices and logistics are set up, dataniz can generate data to be sent to database

**IoT Sensor Research**

1. Kitchen Fridge Sensor\
   a. Measures moisture levels\
   b. Data type: Absolute moisture converted to Relative Humidity (RH%)\
   c. Temperature sensor, Current sensor, Moisture Content Sensor

2. Dishwasher Sensor\
   a. Tracks water consumption\
   b. Data type: Water usage per cycle (Converted from liters to gallons)\
   c. Water Level sensor & Current sensor

3. Power Consumption Sensor\
   a. Monitors electricity usage for all devices\
   b. Measurement: Watts, converted to kilowatt-hours (kWh)

**Metadata Utilization**\
We integrated dataniz metadata through the load_device_metadata() method, which:

-   Retrieves device information from the fridge_metadata collection
-   Maps device names to consistent internal references
-   Extracts critical metadata:
    -   Device unique identifiers (assetUid, device name, sensor names)
    -   Device types
    -   Sensor-specific attributes

## Local Development/Testing

Open a directory with both files included. In the console, run `python server.py`. Select an appropriate server address and port. For example, use `localhost` for server address and port `5000`. Within the `server.py` code, change or replace the `db_uri` to your appropriate database connection (if you want). I do not advise changing using your own database for testing because it will mess up with mappings of the devices and their sensors because of the naming mismatch. In the console, run `python client.py` and try to establish a connection with the server. For local developmet/testing, use `localhost` and port `5000`. There are 3 query options. Choose 1 and the query will be compiled and printed.

## Google Cloud VMs Development/Testing

Open each VMs for each for the server and client machines. Upload the files to each respective VM. For the server, use server address `0.0.0.0` to allow all connections and choose any port (e.g. `5000`). For the client, use the VM's external address as the targetted server address (e.g. 35.222.162.8) and choose any port (e.g. `5000`). Again, choose any query and the appropriate response to compile and run.

## Challenges and Solutions

Developing this end-to-end IoT system presented several complex challenges because the instructions were broad which requires innovative problem solving approaches. One of the significant hurdles was managing the inconsistent and dynamic nature of mapping through the data generated by dataniz. Since our naming convention was nonexistent, it was difficult to refer to which data was from each sensor (e.g. device1 sensor 1). To make it easier to correlate data, we renamed all the devices and sensors with appropriate descriptive names (e.g. kitchen_fridge Power Sensor, garage_fridge Temp Sensor, etc). Another challenge was the importance of observability and debugging the data are extracted from the MongoDB collection. Extensive logging was integrated throughout the server implementation, with print statements strategically placed to provide granular insights into data processing stages. This approach not only aids in immediate troubleshooting but also provides a comprehensive audit trail of how queries are handled, making future system enhancements and maintenance more manageable.

## Conclusion

In all, our IoT system integrates TCP client-server communication, MongoDB for data storage, and IoT devices from dataniz. By including detailed metadata for the IoT devices, we were able to ensure data handling and device identification. Our system monitors and processes data such as relative humidity, water usage, and power consumption through IoT sensors and data conversions. Despite challenges with inconsistent mapping and debugging, we overcame it by renaming the devices and sensors while including comprehensive logging. With these solutions, it would allow for the completion of our program, which would be reliable and maintainable for IoT applications.

## Architecture

![IoT System Architecture](https://github.com/kietn20/End-to-End-IoT-System/blob/main/diagram.png)
